

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Toy Data Example 1 &mdash; Kernel-change-point-detection 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Kernel-change-point-detection
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guidelines.html">üí° Guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">üîÑ Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">üîé Package kcpdi</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kernel-change-point-detection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Toy Data Example 1</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/Example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Toy-Data-Example-1">
<h1>Toy Data Example 1<a class="headerlink" href="#Toy-Data-Example-1" title="Link to this heading">ÔÉÅ</a></h1>
<p>In this example we will generate some synthetic multidimensional time series data and then run the kernel change-point detection (kcp_ds) and visualization (kcp_v) Python functions on it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ruptures</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rpt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">gaussian_kde</span>

<span class="c1"># import sys; sys.path.insert(0, &quot;..&quot;)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kcpdi.kcp_ds</span><span class="w"> </span><span class="kn">import</span> <span class="n">kcp_ds</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kcpdi.kcp_v</span><span class="w"> </span><span class="kn">import</span> <span class="n">kcp_v</span>
</pre></div>
</div>
</div>
</section>
<section id="Toy-example">
<h1>Toy example<a class="headerlink" href="#Toy-example" title="Link to this heading">ÔÉÅ</a></h1>
<p>In order to run the functions, it is necessary to have a numpy array containing the data we wish to feed to the functions. This array must be of dimension (number of time points) <strong>x</strong> (number of parallel time series).</p>
<p>This therefore supposes that the data you wish to work with is either already in this form (same time points for all time series) or than you have taken raw data (perhaps with differing time points for different time series) and interpolated it to a fixed time grid.</p>
<p>For real datasets, some of the following steps will also probably need to be taken before running the functions:</p>
<ol class="arabic simple">
<li><p>Removing or imputing missing data. The functions assume that there is no missing data or non-numeric values.</p></li>
<li><p>Normalizing the data in some way. If some time series have much larger numerical ranges than others, then their changes and anomalies will have an outsized effect on the function outputs. This may be what you expect, so in that case, you do not necessarily have to do any normalization. But if you want the functions to more-or-less treat all time series equally, it might be a good idea to individually normalize each time series to have mean 0 and variance 1, or perform some other normalization
(e.g., an affine map so that each time series has a minimum of 0 and a maximum of 1.</p></li>
</ol>
<section id="Generate-time-series-data">
<h2>Generate time series data<a class="headerlink" href="#Generate-time-series-data" title="Link to this heading">ÔÉÅ</a></h2>
<p>The code block below generates <strong>num_columns</strong> time series with <strong>num_rows</strong> time points each (the same ones). It generates N(0,1) random Gaussian data and adds it to the running value of the mean. At each new time point there is a probability of <strong>mean_jump_probability</strong> that there will be a jump in the mean to a new mean, and so on until the end of the <strong>num_rows</strong> time points.</p>
<p>To spice things up, we propose that there are <strong>num_peak_rows</strong> special time points at which it is <strong>much more likely that there is a change-point</strong> for each time series. In the code below, it is a 50x more likely for there to be a change-point in the mean at five randomly chosen times.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_random_data_with_random_peaks</span><span class="p">(</span>
    <span class="n">num_rows</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">num_columns</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">mean_jump_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span>
    <span class="n">num_peak_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a NumPy array with Gaussian data and random jumps in</span>
<span class="sd">    mean at specified peak rows.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_rows: Number of rows (time points).</span>
<span class="sd">        num_columns: Number of columns (time series).</span>
<span class="sd">        mean_jump_probability: Base probability of a mean jump occurring</span>
<span class="sd">            in a column.</span>
<span class="sd">        num_peak_rows: Number of peak rows with increased jump</span>
<span class="sd">            probability.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The generated NumPy array.</span>
<span class="sd">        The list of jump positions for each column.</span>
<span class="sd">        The row indices of the peak rows.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">num_peak_rows</span> <span class="o">&gt;=</span> <span class="n">num_rows</span><span class="p">):</span>
        <span class="n">num_peak_rows</span> <span class="o">=</span> <span class="n">num_rows</span><span class="o">-</span><span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The variable num_peak_rows was greater than or equal to num_rows, we have reduced it to size num_rows-1&quot;</span><span class="p">)</span>


    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">))</span>
    <span class="n">jump_positions</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_columns</span><span class="p">)]</span>

    <span class="c1"># Randomly select row indices for peak rows</span>
    <span class="n">peak_rows</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">),</span> <span class="n">num_peak_rows</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_columns</span><span class="p">):</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Initialize mean for this column</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">peak_rows</span><span class="p">:</span>
                <span class="n">jump_prob</span> <span class="o">=</span> <span class="n">mean_jump_probability</span> <span class="o">*</span> <span class="mi">50</span>  <span class="c1"># Higher probability at peak rows</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">jump_prob</span> <span class="o">=</span> <span class="n">mean_jump_probability</span>

            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">jump_prob</span><span class="p">:</span>
                <span class="c1"># Randomly jump the mean</span>
                <span class="n">jump</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">mean</span> <span class="o">+=</span> <span class="n">jump</span>
                <span class="n">jump_positions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">jump</span><span class="p">))</span>

            <span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Generate Gaussian data with the current mean</span>

        <span class="c1"># Normalize the column to have mean 0 and variance 1</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">col</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">jump_positions</span><span class="p">,</span> <span class="n">peak_rows</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_rows</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Number of time points</span>
<span class="n">num_columns</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># Number of time series</span>
<span class="n">mean_jump_probability</span> <span class="o">=</span> <span class="mf">0.005</span>  <span class="c1"># Base jump probability</span>
<span class="n">num_peak_rows</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Number of peak rows</span>

<span class="c1"># Call the function to generate random data with random peak rows</span>
<span class="n">random_data</span><span class="p">,</span> <span class="n">jump_positions</span><span class="p">,</span> <span class="n">peak_rows</span> <span class="o">=</span> <span class="n">generate_random_data_with_random_peaks</span><span class="p">(</span>
    <span class="n">num_rows</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">,</span> <span class="n">mean_jump_probability</span><span class="p">,</span> <span class="n">num_peak_rows</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Plot-the-generated-data-for-a-subset-of-the-time-series">
<h2>Plot the generated data for a subset of the time series<a class="headerlink" href="#Plot-the-generated-data-for-a-subset-of-the-time-series" title="Link to this heading">ÔÉÅ</a></h2>
<p>The function below will plot at most 20 generated time series. It will output these plots of the data along with vertical red lines showing where each time series‚Äôs changes in mean were.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_data_in_subplots_with_lines_limited</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">jump_positions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Random Data with Jumps&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the generated data for each column in separate subplots with</span>
<span class="sd">    vertical red lines at jump positions.</span>

<span class="sd">    Limit the number of subplots displayed to at most 20 if there are</span>
<span class="sd">    more columns.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The generated data as a NumPy array.</span>
<span class="sd">        jump_positions: List of jump positions for each column.</span>
<span class="sd">        title: Title of the overall plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">num_columns</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="c1"># If there are more than 20 columns, limit to the first 20</span>
        <span class="n">num_columns</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num_columns</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_columns</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">jump_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">position</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jump&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time Points&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Values&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="n">jump_positions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
                <span class="n">row</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">position</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jump&quot;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time Points&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Values&quot;</span><span class="p">)</span>
            <span class="c1">#ax.legend()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Run-the-plotting-function">
<h2>Run the plotting function<a class="headerlink" href="#Run-the-plotting-function" title="Link to this heading">ÔÉÅ</a></h2>
<p>Now run the above plotting function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Usage:</span>
<span class="c1"># Assuming you have already generated random_data and jump_positions</span>
<span class="n">plot_data_in_subplots_with_lines_limited</span><span class="p">(</span><span class="n">random_data</span><span class="p">,</span> <span class="n">jump_positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_9_0.png" src="../_images/examples_Example_9_0.png" />
</div>
</div>
</section>
<section id="Histogram-and-kernel-smoothing-of-true-change-point-locations">
<h2>Histogram and kernel smoothing of true change-point locations<a class="headerlink" href="#Histogram-and-kernel-smoothing-of-true-change-point-locations" title="Link to this heading">ÔÉÅ</a></h2>
<p>For a sanity check, we can plot the distribution of change-point locations across the whole dataset and check that there are indeed some hotspots where many more individual time series had changes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assuming you have generated data and jump_positions using generate_random_data_with_jumps</span>
<span class="n">combined_jump_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span> <span class="k">for</span> <span class="n">positions</span> <span class="ow">in</span> <span class="n">jump_positions</span> <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">]</span>

<span class="c1"># Extract the row positions where jumps occurred</span>
<span class="n">jump_row_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">combined_jump_positions</span><span class="p">]</span>

<span class="c1"># Create a histogram to show where the jump positions were mostly located</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Create a subplot on the left</span>

<span class="n">hist</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">jump_row_positions</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histogram of Jump Positions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time Points&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Perform Gaussian kernel density smoothing of the histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Create a subplot on the right</span>

<span class="c1"># Create a Gaussian kernel density estimate</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">jump_row_positions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">my_bandwidth</span> <span class="o">=</span> <span class="mf">.01</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">jump_row_positions</span><span class="p">,</span><span class="n">bw_method</span><span class="o">=</span><span class="n">my_bandwidth</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gaussian Kernel Smoothing&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Gaussian Kernel Smoothing of change-point hotspots&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time Points&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">),[</span><span class="n">i</span><span class="o">*</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gaussian Kernel Smoothing&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Gaussian Kernel Smoothing of change-point hotspots&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time Points&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_11_0.png" src="../_images/examples_Example_11_0.png" />
</div>
</div>
<p>It will probably be clearest on the Gaussian kernel smoothing subplot (right) that there are a few hotspots where more change-points were located on average. Let us look at where these hotspots were actually located:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The randomly generated change-point hotspot times were: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">peak_rows</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The randomly generated change-point hotspot times were:  [ 54 491 586 627 983]
</pre></div></div>
</div>
</section>
<section id="Run-the-kernel-change-point-detection-algorithm">
<h2>Run the kernel change-point detection algorithm<a class="headerlink" href="#Run-the-kernel-change-point-detection-algorithm" title="Link to this heading">ÔÉÅ</a></h2>
<p>We are now ready to run the kernel change-point detection algorithm on the generated <strong>data</strong> above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_data</span> <span class="o">=</span> <span class="n">random_data</span>

<span class="n">detected_change_points</span><span class="p">,</span> <span class="n">interval_end_points</span> <span class="o">=</span> <span class="n">kcp_ds</span><span class="p">(</span><span class="n">my_data</span><span class="p">,</span> <span class="n">expected_frac_anomaly</span><span class="o">=</span><span class="mi">15</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The detected change-points are at times: &#39;</span><span class="p">,</span> <span class="n">detected_change_points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The detected change-points are at times:  [61, 202, 339, 491, 586, 673, 796, 946]
</pre></div></div>
</div>
</section>
<section id="Remarks">
<h2>Remarks<a class="headerlink" href="#Remarks" title="Link to this heading">ÔÉÅ</a></h2>
<p>If you have come this far without changing any of the code, you will likely see that there are more detected change-points than there are hotspots, but that most likely the hotspots correspond to detected change-points (give or take one or two time steps to the left or right).</p>
<p>This is normal because there are indeed other time spots at which, by chance, there were also more change-points than average randomly generated. If you take the detected change-points that are not in <strong>peak_rows</strong>, they most likely correspond to high density spots in the above Gaussian kernel density plot too.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rpt</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">my_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">my_data</span><span class="p">)[</span><span class="mi">1</span><span class="p">])],</span> <span class="n">detected_change_points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 1000x2000 with 10 Axes&gt;,
 array([&lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;,
        &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;, &lt;Axes: &gt;], dtype=object))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_17_1.png" src="../_images/examples_Example_17_1.png" />
</div>
</div>
</section>
<section id="Visualizing-the-contribution-of-individual-time-series-to-the-detection-of-a-change-point">
<h2>Visualizing the contribution of individual time series to the detection of a change-point<a class="headerlink" href="#Visualizing-the-contribution-of-individual-time-series-to-the-detection-of-a-change-point" title="Link to this heading">ÔÉÅ</a></h2>
<p>The following code block goes through the detected change-points, one by one, and tries to tease out which of the individual time series were responsible (i.e., explain) the detection of the change-point.</p>
<p>Below, we plot the overall linear kernel change-point detection criterion (in blue) recalculated between:</p>
<ul class="simple">
<li><p>left boundary: either the previous change-point or else time point 0 if we are looking at the first change-point</p></li>
<li><p>right boundary: either the next change-point, the end-point of the data, or, if the number of time points was large, possible the right boundary is some time point <strong>before</strong> the next change-point (or end point). This latter possibility may occur when the number of data points is greater than <strong>max_n_time_points</strong>, an input into the kcp_ds function, since the underlying code requires stocking a matrix of size max_n_time_points x max_n_time_points, so max_n_time_points is chosen so as not to
crash the memory capacity you are working with on your particular PC or server.</p></li>
</ul>
<p>It turns out that when you restrict the criterion to be recalculated over such intervals, it automatically has its minimum at the previously detected change-point. And since we are working with the linear kernel, it turns out that the criterion value at each time is equal to the <strong>sum</strong> of the criteria for each of the individual time series, when calculated <strong>alone</strong> !</p>
<p>This is what we see in the plot below: a blue line corresponding to the global criterion (where its minimum is the change-point location), and several other colored lines corresponding to the <strong>n_legend</strong> individual time series whose criterion was the <strong>lowest</strong> at the shared change-point time (the time point at the minimum of the blue line).</p>
<p>All of the other individual time series criteria are drawn in black in order to simplify interpretation of the more important (colored) ones.</p>
<p><strong>Remarks</strong></p>
<ol class="arabic simple">
<li><p>Note that to get into the list of the top <strong>n_legend</strong> time series, you do not necessarily have to have your minimum at the same place as the global minimum. What you <strong>do</strong> need to do is to have one of the <strong>n_legend</strong> smallest values at the time corresponding to the global minimum.</p></li>
<li><p>A consequence of this is that an individual time series would have actually placed a change-point elsewhere in the interval if only its personal criterion was used, but <strong>since it still has a low value</strong> at the global minimum, it still had a partial influence on the location of the global minimum.</p></li>
<li><p>This kind of information could get lost if you are looking at numerical outputs and ordered lists of importance, but <strong>is very clear</strong> when you use these kinds of plots.</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_times</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">my_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">kcp_v</span><span class="p">(</span><span class="n">my_data</span><span class="p">,</span> <span class="n">true_times</span><span class="p">,</span> <span class="n">detected_change_points</span><span class="p">,</span> <span class="n">interval_end_points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Change point number 1

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_19_1.png" src="../_images/examples_Example_19_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Change point number 2

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_19_3.png" src="../_images/examples_Example_19_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Change point number 3

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_19_5.png" src="../_images/examples_Example_19_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Change point number 4

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_19_7.png" src="../_images/examples_Example_19_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Change point number 5

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_19_9.png" src="../_images/examples_Example_19_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Change point number 6

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_19_11.png" src="../_images/examples_Example_19_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Change point number 7

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_19_13.png" src="../_images/examples_Example_19_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Change point number 8

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Example_19_15.png" src="../_images/examples_Example_19_15.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, INRIA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>